//@version=6
strategy("Gold Triple MA Cross Strategy (MT5 Specs)",
         overlay=true,
         initial_capital=10000,
         default_qty_value=1, // Example: Allocates 1% of total equity for each trade
         default_qty_type=strategy.percent_of_equity)

// 1. Calculate the base (unshifted) Simple Moving Averages based on 'Close' price
purple_ma_base = ta.sma(close, 11)
red_ma_base = ta.sma(close, 76)
black_ma_base = ta.sma(close, 100)

// 2. Apply the specified shifts to the MAs for use in the strategy logic.
// A positive 'shift' (like in MT5) means we use the MA value from 'shift' bars ago, 
// effectively plotting the current MA value 'shift' bars to the right.
purple_ma = purple_ma_base      // Purple MA: Shift is 0
red_ma = red_ma_base[19]      // Red MA: Shift is 19
black_ma = black_ma_base[100]    // Black MA: Shift is 100

// 3. Define Signals
// Buy Signal: Purple MA crosses OVER Red MA.
// Condition: This must happen while the Purple and Red MAs are BOTH above the Black MA.
buy_signal = ta.crossover(purple_ma, red_ma) and purple_ma > black_ma and red_ma > black_ma

// Sell Signal: Purple MA crosses UNDER Red MA.
// Condition: This must happen while the Purple and Red MAs are BOTH below the Black MA.
sell_signal = ta.crossunder(purple_ma, red_ma) and purple_ma < black_ma and red_ma < black_ma

// Exit Signal: Red MA crosses Black MA
exit_signal = ta.cross(red_ma, black_ma)

// 4. Strategy Entry and Exit Logic
// The strategy.position_size variable checks if there is currently an open position.
// It will be 0 if no position is open.
// This ensures we only enter a new trade when there isn't one already active.
if (buy_signal and strategy.position_size == 0)
    strategy.entry("Buy", strategy.long)

if (sell_signal and strategy.position_size == 0)
    strategy.entry("Sell", strategy.short)

// If the exit signal is true, close all open positions (both long and short).
if (exit_signal)
    strategy.close_all(comment = "EXIT - Red MA crossed Black MA") 

// 5. Plot the shifted Moving Averages on the chart for visual confirmation
plot(purple_ma, color=color.purple, title="Purple MA (Shift 0)", linewidth=2)
plot(red_ma, color=color.red, title="Red MA (Shift 19)", linewidth=2)
plot(black_ma, color=color.black, title="Black MA (Shift 100)", linewidth=3)

// 6. Plot shapes on the chart to indicate signals visually
plotshape(buy_signal, title='Buy Signal', style=shape.labelup, color=color.green, text="BUY", textcolor=color.white, size=size.normal)
plotshape(sell_signal, title='Sell Signal', style=shape.labeldown, color=color.red, text="SELL", textcolor=color.white, size=size.normal)
plotshape(exit_signal, title='Exit Signal', style=shape.circle, color=color.yellow, text="EXIT", textcolor=color.black, size=size.small)
